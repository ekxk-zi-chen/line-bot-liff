<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>簡報&勤前清單</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body, html {
      margin: 0;
      padding: 0;
      height: 100vh;
      font-family: Arial, sans-serif;
    }

    .container {
      display: flex;
      height: 100%;
    }

    .sidebar {
      width: 240px;
      background-color: #2c3e50;
      color: white;
      padding-top: 60px;    /* 改這裡，原本是 20px，改成60px讓上方空出來 */
      padding-right: 20px;  /* 其餘保持20px */
      padding-bottom: 20px;
      padding-left: 20px;
      overflow-y: auto;
      transition: transform 0.3s ease;
    }

    .sidebar h2 {
      font-size: 20px;
      margin-bottom: 16px;
    }

    .sidebar ul {
      list-style: none;
      padding: 0;
    }

    .sidebar ul li {
      margin: 12px 0;
      cursor: pointer;
      color: #ecf0f1;
    }

    .sidebar ul li:hover {
      color: #1abc9c;
    }

    .main-content {
      flex-grow: 1;
      position: relative;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .menu-button {
      display: none;
      position: fixed;
      top: 10px;
      left: 10px;
      background-color: #2c3e50;
      color: white;
      border: none;
      padding: 10px 14px;
      font-size: 16px;
      cursor: pointer;
      z-index: 1000;
    }

    /* 手機版：隱藏 sidebar，改顯示 menu 按鈕 */
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        height: 100%;
        z-index: 999;
        transform: translateX(-100%);
        width: 240px;
        padding-top: 20px;
      }
      .sidebar h2 {
        margin-top: 60px;
        background-color: #2c3e50; /* 避免按鈕疊上去看不到文字 */
        padding: 10px 0 10px 0;
      }
      .main-content {
        width: 100vw;
        height: 100vh;
      }
    
      .sidebar.open {
        transform: translateX(0);
      }

      .menu-button {
        display: block;
        position: fixed; /* fixed 讓它永遠在畫面左上角 */
        top: 10px;
        left: 10px;
        background-color: #2c3e50;
        color: white;
        border: none;
        padding: 10px 14px;
        font-size: 16px;
        cursor: pointer;
        z-index: 1000;
      }

      .container {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <button class="menu-button" onclick="toggleSidebar()">功能選單</button>

  <div class="container">
    <div class="sidebar" id="sidebar">
      <h2>功能選單</h2>
      <ul>
        <li onclick="selectAndHide('B4')">打開 PDF</li>
        <li onclick="selectAndHide('B5')">打開 個人裝備</li>
        <li onclick="selectAndHide('B6')">打開 人車</li>
      </ul>
    </div>
    <div class="main-content">
      <iframe id="viewer" src=""></iframe>  
    </div>
  </div>

  <script>
  const MOBILE_BREAKPOINT = 768;
  const rm3_slotCache = {};
  let rm3_currentSlot = null;
  
  // --- 讀取 verifyResult ---
  function getVerifyResult() {
    const raw = sessionStorage.getItem('verifyResult');
    const result = JSON.parse(raw);
    console.log("[richmenu_3] 取得 verifyResult:", result);
  
    // slotCache 快取
    if (result.rm3_slotCache) {
      Object.assign(rm3_slotCache, result.rm3_slotCache);
      console.log("[richmenu_3] 回傳的結果快取完成:", rm3_slotCache);
    } else {
      console.warn("[richmenu_3] 回傳的結果中沒有 rm3_slotCache");
    }
  
    return result;
  }
  
  // --- 側邊欄切換 ---
  function toggleSidebar() {
    document.getElementById("sidebar").classList.toggle("open");
  }
  
  function selectAndHide(slot) {
    loadContent(slot);
    const sidebar = document.getElementById("sidebar");
    if (window.innerWidth <= MOBILE_BREAKPOINT) sidebar.classList.remove("open");
  }
  
  // --- 載入 iframe ---(這裡的slot是指iframe的部分)
  function loadContent(slot) {
    if (slot === rm3_currentSlot) return;
    rm3_currentSlot = slot;
    const viewer = document.getElementById("viewer");
  
    if (rm3_slotCache[slot]) {
      viewer.src = rm3_slotCache[slot];  // ✅ 在這裡設定 iframe.src
    } else {
      alert(`找不到 ${slot} 對應的資料，請稍後再試。`);
      console.warn(`[richmenu_3] rm3_slotCache 中沒有 ${slot}`);
    }
  }
  
  // --- 初始化 ---
  window.addEventListener("DOMContentLoaded", () => {
    const verifyResult = getVerifyResult();
    if (!verifyResult) return;
  
    const initialSlot = verifyResult.slot || "B4";
  
    // 直接載入 iframe
    loadContent(initialSlot);
  });
  
  // --- 點擊 main-content 空白關閉側邊欄 ---
  document.getElementById("main-content").addEventListener("click", () => {
    const sidebar = document.getElementById("sidebar");
    if (window.innerWidth <= MOBILE_BREAKPOINT && sidebar.classList.contains("open")) {
      sidebar.classList.remove("open");
    }
  });
  
  // --- 阻止 sidebar 點擊冒泡 ---
  document.getElementById("sidebar").addEventListener("click", e => e.stopPropagation());
  </script>


</body>
</html>

