<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å·²å ±åäººæ•¸</title>
    <style>
      body {
        font-family: "æ¨™æ¥·é«”", "PMingLiU", "DFKai-SB", serif;
        background: #f5f7fa;
        padding: 30px 20px;
        color: #333;
        line-height: 1.8;
      }
      .container {
        position: relative;
        max-width: 700px; /* æ”¾å¤§å¯¬åº¦ */
        margin: 40px auto 20px;
        padding-top: 40px; /* é ç•™æŒ‰éˆ•ç©ºé–“ */
      }
      #refreshBtn {
        position: absolute;
        top: 0;
        right: 0;
        padding: 8px 14px;
        font-size: 16px;
        cursor: pointer;
        border: 1px solid #4CAF50;
        background: white;
        color: #4CAF50;
        border-radius: 6px;
        transition: background-color 0.3s ease, color 0.3s ease;
        z-index: 10;
      }
      #refreshBtn:hover {
        background-color: #4CAF50;
        color: white;
      }
      .card {
        max-width: 700px;
        margin: 20px auto;
        background: white;
        padding: 28px 36px;
        border-radius: 16px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        box-sizing: border-box;
      }
      h2, #title {
        font-weight: bold;
        font-size: 40px;
        text-align: center;
        margin: 0 0 10px;
        color: #222;
      }
      #script, #description, #note {
        font-size: 20px; /* æ”¾å¤§å…§å®¹å­—é«” */
        color: #666;
        font-style: italic;
        text-align: center;
        margin-bottom: 24px;
        white-space: pre-wrap;  /* é‡è¦ï¼šä¿ç•™æ›è¡Œ */
      }
      #description {
        font-size: 24px;
        text-align: center;
        margin-bottom: 24px;
      }
      #note {
        margin-bottom: 24px;
      }
      #note p {
        font-size: 24px;
        margin: 6px 0;
        position: relative;
        padding-left: 28px;
        color: #444;
      }
      #note p::before {
        content: "ğŸš’";
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        font-size: 24px;
      }
      ul#items {
        list-style: none;
        padding-left: 0;
        margin: 0;
        max-height: 300px;
        overflow-y: left;
      }
      ul#items li {
        font-size: 24px;
        padding: 8px 12px;
        border-bottom: 1px solid #eee;
        border-radius: 8px;
        background: #fafafa;
        margin-bottom: 8px;
      }
      .error {
        color: #d32f2f;
        font-weight: 700;
        font-size: 24px;
        text-align: center;
        margin-top: 20px;
      }
    </style>
</head>
<body>
  <div class="container" style="position: relative; max-width: 700px; margin: 20px auto;">
    <button id="refreshBtn">ğŸ”„ åˆ·æ–°</button>

      
    <div class="card">
      <div style="text-align: center; line-height: 1.5; margin-bottom: 12px;">
        <div id="title" style="font-size: 40px; font-weight: bold;">çµ±è¨ˆäººæ•¸ä¸­...</div>
        <div id="script" style="font-size: 24px; color: gray; margin-top: 4px;"></div>
      </div>
        
      <p id="description" style="text-align: center;"></p>
      <p id="note" style="text-align: center;"</p>
      <ul id="items" style="text-align: center; list-style-position: inside;"></ul>
      <p id="error-msg" class="error" style="display:none;"></p>
    </div>


    <script>
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwyzcire5j9gDVAcANdaIVaD6_4R6jOl-0MtllgzM3HdQTPeedvFThy7IHCG6yEZuSd9A/exec";
        const SLOT = "special"; // æˆ–ä½ éœ€è¦çš„ slot å€¼

        async function fetchData() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const userId = urlParams.get('userId') || "";
                const response = await fetch(`${APPS_SCRIPT_URL}?slot=${encodeURIComponent(SLOT)}&userId=${encodeURIComponent(userId)}&t=${Date.now()}`, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP éŒ¯èª¤ ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('æ”¶åˆ°è³‡æ–™:', data);
                if (data.status !== "special") {
                  throw new Error(`è³‡æ–™ç‹€æ…‹é 'special'ï¼Œå¯¦éš›ç‚º '${data.status}'`);
                }
                
                document.getElementById("title").textContent = data.title || "ç„¡æ¨™é¡Œ";
                document.getElementById("script").textContent = data.script || "";





                document.getElementById("description").textContent = data.description || "";
                const noteContainer = document.getElementById("note");
                noteContainer.innerHTML = "";
                if (Array.isArray(data.note)) {
                  data.note.forEach(line => {
                    const p = document.createElement("p");
                    p.textContent = line;
                    noteContainer.appendChild(p);
                  });
                } else {
                  noteContainer.textContent = data.note || "";
                }
                
                const ul = document.getElementById("items");
                ul.innerHTML = ""; // æ¸…ç©ºèˆŠè³‡æ–™

                (data.items || []).forEach(item => {
                    const li = document.createElement("li");
                    li.textContent = item;
                    ul.appendChild(li);
                });
            } catch (error) {
                document.getElementById("error-msg").style.display = "block";
                document.getElementById("error-msg").textContent = "è®€å–è³‡æ–™å¤±æ•—ï¼š" + error.message;

                document.getElementById("title").textContent = "éŒ¯èª¤";
                document.getElementById("description").textContent = "";
                document.getElementById("items").innerHTML = "";
                console.error(error);
            }
        }
        // ç¶å®šæŒ‰éˆ•äº‹ä»¶
        const refreshBtn = document.getElementById('refreshBtn');
        refreshBtn.addEventListener('click', () => {
        fetchData();
        });
    
      // é é¢è¼‰å…¥æ™‚å…ˆåŸ·è¡Œä¸€æ¬¡
        fetchData();
    </script>
</body>
</html>
