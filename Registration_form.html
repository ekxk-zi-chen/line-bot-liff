<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>已報名人數</title>
    <style>
      body {
        font-family: "標楷體", "PMingLiU", "DFKai-SB", serif;
        background: #f5f7fa;
        padding: 30px 20px;
        color: #333;
        line-height: 1.8;
      }
      .container {
        max-width: 700px;
        margin: 40px auto 20px;
        padding-top: 0;
      }
      .card {
        max-width: 700px;
        margin: 0 auto;
        background: white;
        padding: 28px 36px;
        border-radius: 16px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        box-sizing: border-box;
      }
      #header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
      }
      #title {
        font-weight: bold;
        font-size: 40px;
        color: #222;
        user-select: none;
      }
      #refreshBtn {
        padding: 6px 12px;
        font-size: 16px;
        cursor: pointer;
        border: 1px solid #4CAF50;
        background: white;
        color: #4CAF50;
        border-radius: 6px;
        transition: background-color 0.3s ease, color 0.3s ease;
        user-select: none;
      }
      #refreshBtn:hover {
        background-color: #4CAF50;
        color: white;
      }
      #script {
        font-size: 24px;
        color: gray;
        margin-bottom: 24px;
        font-style: italic;
        text-align: center;
        white-space: pre-wrap; /* 保留換行 */
      }
      #description {
        font-size: 24px;
        text-align: center;
        margin-bottom: 24px;
        white-space: pre-wrap;
      }
      #note {
        font-size: 24px;
        color: #444;
        margin-bottom: 24px;
        text-align: center;
        white-space: pre-wrap;
      }
      ul#items {
        list-style: none;
        padding-left: 0;
        margin: 0;
        max-height: 300px;
        overflow-y: auto;
      }
      ul#items li {
        font-size: 24px;
        padding: 8px 12px;
        border-bottom: 1px solid #eee;
        border-radius: 8px;
        background: #fafafa;

        display: flex;
        align-items: center;     /* 文字與 emoji 垂直置中 */
        justify-content: center; /* 整行置中 */
        gap: 8px;                /* emoji 與文字間距 */
        text-align: center;
        user-select: none;
      }
      ul#items li::before {
        content: "🚒";
        font-size: 24px;
      }
      .error {
        color: #d32f2f;
        font-weight: 700;
        font-size: 24px;
        text-align: center;
        margin-top: 20px;
      }
    </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div id="header">
        <div id="title">統計人數中...</div>
        <button id="refreshBtn" type="button">🔄 刷新</button>
      </div>

      <div id="script"></div>
      <p id="description"></p>
      <p id="note"></p>
      <ul id="items"></ul>
      <p id="error-msg" class="error" style="display:none;"></p>
    </div>
  </div>

  <script>
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwyzcire5j9gDVAcANdaIVaD6_4R6jOl-0MtllgzM3HdQTPeedvFThy7IHCG6yEZuSd9A/exec";
    const SLOT = "special"; // 或你需要的 slot 值

    async function fetchData() {
      try {
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('userId') || "";
        const response = await fetch(`${APPS_SCRIPT_URL}?slot=${encodeURIComponent(SLOT)}&userId=${encodeURIComponent(userId)}&t=${Date.now()}`, {
          method: 'GET',
          mode: 'cors',
          headers: {
            'Accept': 'application/json'
          }
        });

        if (!response.ok) {
          throw new Error(`HTTP 錯誤 ${response.status}: ${response.statusText}`);
        }

        const data = await response.json();
        console.log('收到資料:', data);
        if (data.status !== "special") {
          throw new Error(`資料狀態非 'special'，實際為 '${data.status}'`);
        }

        document.getElementById("title").textContent = data.title || "無標題";
        document.getElementById("script").textContent = data.script || "";
        document.getElementById("description").textContent = data.description || "";
        const noteContainer = document.getElementById("note");
        noteContainer.innerHTML = "";
        if (Array.isArray(data.note)) {
          data.note.forEach(line => {
            const p = document.createElement("p");
            p.textContent = line;
            noteContainer.appendChild(p);
          });
        } else {
          noteContainer.textContent = data.note || "";
        }

        const ul = document.getElementById("items");
        ul.innerHTML = ""; // 清空舊資料
        (data.items || []).forEach(item => {
          const li = document.createElement("li");
          li.textContent = item;
          ul.appendChild(li);
        });

        // 隱藏錯誤訊息
        document.getElementById("error-msg").style.display = "none";
        document.getElementById("error-msg").textContent = "";
      } catch (error) {
        document.getElementById("error-msg").style.display = "block";
        document.getElementById("error-msg").textContent = "讀取資料失敗：" + error.message;
        document.getElementById("title").textContent = "錯誤";
        document.getElementById("description").textContent = "";
        document.getElementById("items").innerHTML = "";
        console.error(error);
      }
    }

    // 綁定按鈕事件
    document.getElementById('refreshBtn').addEventListener('click', fetchData);

    // 頁面載入時先執行一次
    fetchData();
  </script>
</body>
</html>
