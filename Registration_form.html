<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>å·²å ±åäººæ•¸</title>
    <style>
      body {
        font-family: "æ¨™æ¥·é«”", "PMingLiU", "DFKai-SB", serif;
        background: #f5f7fa;
        padding: 30px 20px;
        color: #333;
        line-height: 1.8;
      }
      .container {
        max-width: 700px;
        margin: 40px auto 20px;
        padding-top: 0;
      }
      .card {
        max-width: 700px;
        margin: 0 auto;
        background: white;
        padding: 28px 36px;
        border-radius: 16px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        box-sizing: border-box;
      }
      #header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
      }
      #title {
        font-weight: bold;
        font-size: 40px;
        color: #222;
        user-select: none;
      }
      #refreshBtn {
        padding: 6px 12px;
        font-size: 16px;
        cursor: pointer;
        border: 1px solid #4CAF50;
        background: white;
        color: #4CAF50;
        border-radius: 6px;
        transition: background-color 0.3s ease, color 0.3s ease;
        user-select: none;
      }
      #refreshBtn:hover {
        background-color: #4CAF50;
        color: white;
      }
      #script {
        font-size: 24px;
        color: gray;
        margin-bottom: 24px;
        font-style: italic;
        text-align: center;
        white-space: pre-wrap; /* ä¿ç•™æ›è¡Œ */
      }
      #description {
        font-size: 24px;
        text-align: center;
        margin-bottom: 24px;
        white-space: pre-wrap;
      }
      #note {
        font-size: 24px;
        color: #444;
        margin-bottom: 24px;
        text-align: center;
        white-space: pre-wrap;
      }
      ul#items {
        list-style: none;
        padding-left: 0;
        margin: 0;
        max-height: 300px;
        overflow-y: auto;
      }
      ul#items li {
        font-size: 24px;
        padding: 8px 12px;
        border-bottom: 1px solid #eee;
        border-radius: 8px;
        background: #fafafa;

        display: flex;
        align-items: center;     /* æ–‡å­—èˆ‡ emoji å‚ç›´ç½®ä¸­ */
        justify-content: center; /* æ•´è¡Œç½®ä¸­ */
        gap: 8px;                /* emoji èˆ‡æ–‡å­—é–“è· */
        text-align: center;
        user-select: none;
      }
      ul#items li::before {
        content: "ğŸš’";
        font-size: 24px;
      }
      .error {
        color: #d32f2f;
        font-weight: 700;
        font-size: 24px;
        text-align: center;
        margin-top: 20px;
      }
    </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div id="header">
        <div id="title">çµ±è¨ˆäººæ•¸ä¸­...</div>
        <button id="refreshBtn" type="button">ğŸ”„ åˆ·æ–°</button>
      </div>

      <div id="script"></div>
      <p id="description"></p>
      <p id="note"></p>
      <ul id="items"></ul>
      <p id="error-msg" class="error" style="display:none;"></p>
    </div>
  </div>

  <script>
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwyzcire5j9gDVAcANdaIVaD6_4R6jOl-0MtllgzM3HdQTPeedvFThy7IHCG6yEZuSd9A/exec";
    const SLOT = "special"; // æˆ–ä½ éœ€è¦çš„ slot å€¼

    async function fetchData() {
      try {
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('userId') || "";
        const response = await fetch(`${APPS_SCRIPT_URL}?slot=${encodeURIComponent(SLOT)}&userId=${encodeURIComponent(userId)}&t=${Date.now()}`, {
          method: 'GET',
          mode: 'cors',
          headers: {
            'Accept': 'application/json'
          }
        });

        if (!response.ok) {
          throw new Error(`HTTP éŒ¯èª¤ ${response.status}: ${response.statusText}`);
        }

        const data = await response.json();
        console.log('æ”¶åˆ°è³‡æ–™:', data);
        if (data.status !== "special") {
          throw new Error(`è³‡æ–™ç‹€æ…‹é 'special'ï¼Œå¯¦éš›ç‚º '${data.status}'`);
        }

        document.getElementById("title").textContent = data.title || "ç„¡æ¨™é¡Œ";
        document.getElementById("script").textContent = data.script || "";
        document.getElementById("description").textContent = data.description || "";
        const noteContainer = document.getElementById("note");
        noteContainer.innerHTML = "";
        if (Array.isArray(data.note)) {
          data.note.forEach(line => {
            const p = document.createElement("p");
            p.textContent = line;
            noteContainer.appendChild(p);
          });
        } else {
          noteContainer.textContent = data.note || "";
        }

        const ul = document.getElementById("items");
        ul.innerHTML = ""; // æ¸…ç©ºèˆŠè³‡æ–™
        (data.items || []).forEach(item => {
          const li = document.createElement("li");
          li.textContent = item;
          ul.appendChild(li);
        });

        // éš±è—éŒ¯èª¤è¨Šæ¯
        document.getElementById("error-msg").style.display = "none";
        document.getElementById("error-msg").textContent = "";
      } catch (error) {
        document.getElementById("error-msg").style.display = "block";
        document.getElementById("error-msg").textContent = "è®€å–è³‡æ–™å¤±æ•—ï¼š" + error.message;
        document.getElementById("title").textContent = "éŒ¯èª¤";
        document.getElementById("description").textContent = "";
        document.getElementById("items").innerHTML = "";
        console.error(error);
      }
    }

    // ç¶å®šæŒ‰éˆ•äº‹ä»¶
    document.getElementById('refreshBtn').addEventListener('click', fetchData);

    // é é¢è¼‰å…¥æ™‚å…ˆåŸ·è¡Œä¸€æ¬¡
    fetchData();
  </script>
</body>
</html>
